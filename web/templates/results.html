{% extends "base.html" %}

{% block content %}
<div class="search-box">
    <h1>Search Engine</h1>
    <form action="/search" method="get">
        <input type="text" name="q" placeholder="Enter your search query..." value="{{ query }}" style="width: 500px; padding: 10px;">
        <button type="submit" style="padding: 10px 20px;">Search</button>
    </form>
</div>

{% if error %}
    <div class="error" style="color: red; margin: 20px 0;">
        <h3>Error:</h3>
        <p>{{ error }}</p>
    </div>
{% endif %}

<div class="results">
    <h3>Results for "{{ query }}" ({{ results|length }} found):</h3>
    
    {% for result in results %}
    <div class="result" style="border: 1px solid #ddd; margin: 15px 0; padding: 15px; border-radius: 5px;">
        <h4 style="margin: 0 0 10px 0;">{{ result.title }}</h4>
        <p style="margin: 5px 0;"><strong>Author:</strong> {{ result.author }}</p>
        
        <!-- Preview text (always shown) -->
        <p id="preview-{{ loop.index }}" style="margin: 10px 0; display: block;">
            {{ result.preview }}
        </p>
        
        <!-- Full text (initially hidden) -->
        <p id="full-{{ loop.index }}" style="margin: 10px 0; display: none;">
            {{ result.content }}
        </p>
        
        <!-- Toggle button -->
        {% if result.content|length > 200 %}
        <button onclick="toggleText({{ loop.index }})" id="toggle-btn-{{ loop.index }}" 
                style="background: #007bff; color: white; border: none; padding: 5px 10px; 
                       border-radius: 3px; cursor: pointer; margin: 5px 0;">
            Show full text
        </button>
        {% endif %}
        
        <small style="color: #666;">Document ID: {{ result.id }}</small>
    </div>
    {% else %}
    <p>No results found.</p>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleText(index) {
    const preview = document.getElementById('preview-' + index);
    const full = document.getElementById('full-' + index);
    const button = document.getElementById('toggle-btn-' + index);
    
    if (full.style.display === 'none') {
        // Show full text
        preview.style.display = 'none';
        full.style.display = 'block';
        button.textContent = 'Hide full text';
        button.style.background = '#6c757d';
    } else {
        // Show preview
        preview.style.display = 'block';
        full.style.display = 'none';
        button.textContent = 'Show full text';
        button.style.background = '#007bff';
    }
}
</script>
{% endblock %}